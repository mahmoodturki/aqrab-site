<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProdShareHub</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #f0f4f8, #d9e2ec);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        #header-ad { text-align: center; margin-bottom: 20px; }
        #login-section, #post-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            max-width: 600px;
            margin: 0 auto 20px;
        }
        #posts {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .post {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .post:hover { transform: translateY(-5px); }
        .post h3 { color: #007bff; margin-top: 0; }
        .post img { max-width: 150px; border-radius: 8px; margin: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .images-container { display: flex; flex-wrap: wrap; gap: 10px; }
        .interaction {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }
        .interaction button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .interaction button:hover { background: #0056b3; }
        .stars {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        .star {
            font-size: 24px;
            color: #ccc;
            transition: color 0.2s;
        }
        .star.filled { color: #ffd700; }
        .star.half-filled {
            background: linear-gradient(to right, #ffd700 50%, #ccc 50%);
            -webkit-background-clip: text;
            color: transparent;
        }
        .stars:hover .star { color: #ffcc00; }
        #visit-count {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        .comment { margin-left: 20px; background: #f8f9fa; padding: 5px 10px; border-radius: 8px; margin-bottom: 5px; }
        #middle-ad { text-align: center; margin: 20px 0; background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
        }
        button { cursor: pointer; }
        #user-info { display: flex; align-items: center; gap: 10px; }
        #profile-img { border: 2px solid #007bff; }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .post img { max-width: 100px; }
        }
    </style>
</head>
<body>

<!-- Top Ad -->
<div id="header-ad">
    <script type="text/javascript">
        atOptions = {
            'key' : '2d5deaded3e62ebc9943db8d8b49f74e',
            'format' : 'iframe',
            'height' : 50,
            'width' : 320,
            'params' : {}
        };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js"></script>
</div>

<!-- Login Section -->
<div id="login-section">
    <h2>Login to ProdShareHub</h2>
    <input type="text" id="username" placeholder="Username">
    <label>Profile Picture (optional):</label>
    <input type="file" id="profile-pic" accept="image/*">
    <button onclick="login()">Login</button>
    <button onclick="logout()" id="logout-btn" style="display:none; background: #dc3545;">Logout</button>
    <div id="user-info" style="display:none; margin-top: 10px;">
        Logged in as: <span id="logged-username"></span>
        <img id="profile-img" width="50" height="50" style="border-radius:50%;">
    </div>
</div>

<!-- Post Section (visible after login) -->
<div id="post-section" style="display:none;">
    <h2>Create a Product Post</h2>
    <input type="text" id="product-name" placeholder="Product Name">
    <textarea id="product-desc" placeholder="Description" rows="4"></textarea>
    <label>Product Images (optional):</label>
    <input type="file" id="product-images" multiple accept="image/*">
    <button onclick="createPost()">Post Product</button>
</div>

<!-- Posts Display -->
<div id="posts"></div>

<!-- Visit Count Badge -->
<div id="visit-count">Visits: 0</div>

<script>
    // Data Structures
    let users = JSON.parse(localStorage.getItem('users')) || {};
    let posts = JSON.parse(localStorage.getItem('posts')) || [];
    let currentUser = null;
    let visits = parseInt(localStorage.getItem('visits')) || 0;

    // Increment and display visits
    visits++;
    localStorage.setItem('visits', visits);
    document.getElementById('visit-count').innerText = `Visits: ${visits}`;

    // Login Function
    function login() {
        const username = document.getElementById('username').value.trim();
        if (!username) return alert('Please enter a username');
        
        if (!users[username]) {
            users[username] = { profilePic: 'https://via.placeholder.com/50' };
        }
        
        const file = document.getElementById('profile-pic').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                users[username].profilePic = e.target.result;
                localStorage.setItem('users', JSON.stringify(users));
                setCurrentUser(username);
            };
            reader.readAsDataURL(file);
        } else {
            setCurrentUser(username);
        }
    }

    // Set Current User
    function setCurrentUser(username) {
        currentUser = username;
        document.getElementById('logged-username').innerText = username;
        document.getElementById('profile-img').src = users[username].profilePic;
        document.getElementById('user-info').style.display = 'flex';
        document.getElementById('logout-btn').style.display = 'inline-block';
        document.getElementById('post-section').style.display = 'block';
        document.querySelectorAll('#login-section input, #login-section button:not(#logout-btn)').forEach(el => el.style.display = 'none');
        renderPosts();
    }

    // Logout
    function logout() {
        currentUser = null;
        document.getElementById('user-info').style.display = 'none';
        document.getElementById('logout-btn').style.display = 'none';
        document.getElementById('post-section').style.display = 'none';
        document.querySelectorAll('#login-section input, #login-section button:not(#logout-btn)').forEach(el => el.style.display = 'block');
        renderPosts();
    }

    // Create Post
    function createPost() {
        if (!currentUser) return alert('Please login first');
        
        const name = document.getElementById('product-name').value.trim();
        const desc = document.getElementById('product-desc').value.trim();
        if (!name || !desc) return alert('Please fill in product name and description');
        
        const images = [];
        const files = document.getElementById('product-images').files;
        const readerPromises = Array.from(files).map(file => {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    images.push(e.target.result);
                    resolve();
                };
                reader.readAsDataURL(file);
            });
        });
        
        Promise.all(readerPromises).then(() => {
            const post = {
                id: Date.now() + Math.random().toString(36).substr(2, 9), // More unique ID
                user: currentUser,
                name,
                desc,
                images,
                likes: 0,
                comments: [],
                shares: 0,
                ratings: [],
                averageRating: 0
            };
            posts.push(post);
            savePosts();
            renderPosts();
            document.getElementById('product-name').value = '';
            document.getElementById('product-desc').value = '';
            document.getElementById('product-images').value = '';
        });
    }

    // Save Posts
    function savePosts() {
        localStorage.setItem('posts', JSON.stringify(posts));
    }

    // Render Posts with Sorting
    function renderPosts() {
        // Sort by interaction score
        posts.sort((a, b) => (b.likes + b.comments.length + b.shares) - (a.likes + a.comments.length + a.shares));
        
        const container = document.getElementById('posts');
        container.innerHTML = '';
        
        posts.forEach((post, index) => {
            const avg = post.averageRating;
            const fullStars = Math.floor(avg);
            const halfStar = avg % 1 >= 0.5 ? 1 : 0;
            
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            postDiv.innerHTML = `
                <h3>${post.name}</h3>
                <p>${post.desc}</p>
                <div class="images-container">${post.images.map(img => `<img src="${img}" alt="Product Image">`).join('')}</div>
                <div class="interaction">
                    <button onclick="likePost('${post.id}')">Like (${post.likes})</button>
                    <button onclick="sharePost('${post.id}')">Share (${post.shares})</button>
                    <div>Share Link: <input type="text" value="${window.location.origin + window.location.pathname + '#' + post.id}" readonly size="30"></div>
                    <div class="stars" data-post-id="${post.id}">
                        Rating: ${avg.toFixed(1)} / 5
                        ${[1,2,3,4,5].map(i => {
                            let className = 'star';
                            if (i <= fullStars) className += ' filled';
                            else if (i === fullStars + 1 && halfStar) className += ' half-filled';
                            return `<span class="${className}" onclick="ratePost('${post.id}', ${i})">â˜…</span>`;
                        }).join('')}
                    </div>
                </div>
                <div>Comments (${post.comments.length}):</div>
                <div id="comments-${post.id}">${post.comments.map(c => `<div class="comment">${c}</div>`).join('')}</div>
                <input type="text" id="comment-input-${post.id}" placeholder="Add a comment...">
                <button onclick="addComment('${post.id}')">Comment</button>
            `;
            container.appendChild(postDiv);
            
            // Insert middle ad after every 3 posts
            if ((index + 1) % 3 === 0) {
                const adDiv = document.createElement('div');
                adDiv.id = 'middle-ad';
                const script1 = document.createElement('script');
                script1.type = 'text/javascript';
                script1.text = `
                    atOptions = {
                        'key' : '2d5deaded3e62ebc9943db8d8b49f74e',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                `;
                adDiv.appendChild(script1);
                const script2 = document.createElement('script');
                script2.type = 'text/javascript';
                script2.src = '//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js';
                adDiv.appendChild(script2);
                container.appendChild(adDiv);
            }
        });
    }

    // Like Post
    function likePost(id) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.likes++;
            savePosts();
            renderPosts();
        }
    }

    // Share Post
    function sharePost(id) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.shares++;
            const link = window.location.origin + window.location.pathname + '#' + id;
            navigator.clipboard.writeText(link).then(() => alert('Link copied to clipboard!'));
            savePosts();
            renderPosts();
        }
    }

    // Rate Post
    function ratePost(id, rating) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.ratings.push(rating);
            post.averageRating = post.ratings.reduce((a, b) => a + b, 0) / post.ratings.length;
            savePosts();
            renderPosts();
        }
    }

    // Add Comment
    function addComment(id) {
        if (!currentUser) return alert('Please login to interact');
        const input = document.getElementById(`comment-input-${id}`);
        const comment = input.value.trim();
        if (!comment) return;
        const post = posts.find(p => p.id === id);
        if (post) {
            post.comments.push(comment);
            input.value = '';
            savePosts();
            renderPosts();
        }
    }

    // Initial Render
    renderPosts();
</script>

</body>
</html>
