<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·</title>
    <!-- Bootstrap 5 RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Google Fonts (Cairo) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #7209b7;
            --accent: #f72585;
            --gold: #ffd700;
            --dark: #2b2d42;
            --light: #edf2f4;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--light), #d9e2ec);
            color: var(--dark);
            min-height: 100vh;
        }
        .navbar {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .navbar-brand, .nav-link {
            color: white !important;
            font-weight: 600;
        }
        .card-video {
            border: none;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .card-video:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: var(--primary);
            border: none;
            border-radius: 12px;
            padding: 10px 24px;
            font-weight: 600;
        }
        .btn-secondary {
            background: var(--secondary);
            border: none;
            border-radius: 12px;
        }
        .btn-accent {
            background: var(--accent);
            border: none;
            border-radius: 12px;
        }
        .progress {
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
        }
        .progress-bar {
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        .badge-premium {
            background: linear-gradient(45deg, var(--gold), #ffb300);
            color: var(--dark);
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .toast {
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .iframe-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 */
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }
        .iframe-container iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: none;
        }
        .special-user {
            border: 3px solid var(--gold);
            position: relative;
        }
        .special-user::after {
            content: 'ğŸ‘‘';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 24px;
            background: var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .queue-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--dark);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1050;
            display: none;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#">ğŸ“º Ù…Ù†ØµØ© ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item">
                    <span id="pointsDisplay" class="nav-link">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</span>
                </li>
                <li class="nav-item">
                    <span id="usernameDisplay" class="nav-link"></span>
                </li>
                <li class="nav-item">
                    <button id="logoutBtn" class="btn btn-outline-light btn-sm d-none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Login / Register Form -->
    <div id="authSection" class="row justify-content-center">
        <div class="col-md-6">
            <div class="card border-0 shadow-lg">
                <div class="card-body p-5">
                    <h3 class="text-center mb-4">ğŸ¯ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</h3>
                    <form id="authForm">
                        <div class="mb-3">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" id="username" class="form-control form-control-lg" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="password" class="form-control form-control-lg" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" id="loginBtn" class="btn btn-primary btn-lg">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                            <button type="button" id="registerBtn" class="btn btn-secondary btn-lg">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until login) -->
    <div id="appSection" class="d-none">
        <!-- Add Video Form -->
        <div class="card mb-4 border-0 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">â• Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h5>
                <form id="addVideoForm" class="row g-3">
                    <div class="col-md-6">
                        <input type="url" id="videoUrl" class="form-control" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ (Ù…Ø«Ø§Ù„: https://youtu.be/...)" required>
                    </div>
                    <div class="col-md-2">
                        <input type="number" id="watchTime" class="form-control" placeholder="Ø§Ù„ÙˆÙ‚Øª (Ø¯Ù‚ÙŠÙ‚Ø©)" min="1" value="5" required>
                    </div>
                    <div class="col-md-2">
                        <input type="number" id="requiredViews" class="form-control" placeholder="Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©" min="1" value="10" required>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-accent w-100">Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Auto Play Controls -->
        <div class="text-center mb-4">
            <button id="autoPlayBtn" class="btn btn-success btn-lg">
                <i class="fas fa-play-circle"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
            </button>
            <button id="stopAutoPlayBtn" class="btn btn-danger btn-lg d-none">
                <i class="fas fa-stop-circle"></i> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </button>
            <div id="queueCounter" class="queue-counter">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="remainingCount">0</span></div>
        </div>

        <!-- Video Player Modal -->
        <div class="modal fade" id="videoModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content border-0 rounded-4 overflow-hidden">
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title" id="modalVideoTitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-0">
                        <div class="iframe-container">
                            <iframe id="youtubePlayer" allowfullscreen></iframe>
                        </div>
                        <div class="p-3 bg-light">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>Ø§Ù„ØªÙ‚Ø¯Ù…:</span>
                                <span id="timerDisplay">00:00 / 00:00</span>
                            </div>
                            <div class="progress">
                                <div id="watchProgress" class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Videos Grid -->
        <div class="row" id="videosGrid">
            <!-- Videos will be injected here -->
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="notificationToast" class="toast align-items-center text-white bg-success border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body" id="toastMessage"></div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // === Global Variables ===
    const DB = {
        users: JSON.parse(localStorage.getItem('viewSwapUsers')) || {},
        videos: JSON.parse(localStorage.getItem('viewSwapVideos')) || [],
        watched: JSON.parse(localStorage.getItem('viewSwapWatched')) || {} // {username: {videoId: true}}
    };

    let currentUser = null;
    let autoPlayQueue = [];
    let isAutoPlaying = false;
    let watchInterval = null;
    let startTime = 0;
    let requiredTime = 0;
    let currentVideoId = null;

    // === Utility Functions ===
    const saveDB = () => {
        localStorage.setItem('viewSwapUsers', JSON.stringify(DB.users));
        localStorage.setItem('viewSwapVideos', JSON.stringify(DB.videos));
        localStorage.setItem('viewSwapWatched', JSON.stringify(DB.watched));
    };

    const showToast = (msg) => {
        const toastEl = document.getElementById('notificationToast');
        document.getElementById('toastMessage').textContent = msg;
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
    };

    const updatePointsDisplay = () => {
        const points = currentUser ? (DB.users[currentUser]?.points || 0) : 0;
        document.getElementById('pointsDisplay').textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${points.toLocaleString()}`;
    };

    const extractYouTubeID = (url) => {
        const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
        const match = url.match(regex);
        return match ? match[1] : null;
    };

    const fetchYouTubeMeta = async (videoId) => {
        // Using oEmbed (no API key needed)
        try {
            const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
            if (response.ok) {
                const data = await response.json();
                return { title: data.title, thumbnail: data.thumbnail_url };
            }
        } catch (e) {
            console.warn('oEmbed failed, using fallback');
        }
        // Fallback: use YouTube thumbnail
        return {
            title: 'ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨',
            thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
        };
    };

    // === Auth System ===
    document.getElementById('loginBtn').addEventListener('click', () => {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');

        if (DB.users[username] && DB.users[username].password === password) {
            currentUser = username;
            loginSuccess();
        } else {
            showToast('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }
    });

    document.getElementById('registerBtn').addEventListener('click', () => {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
        if (DB.users[username]) return showToast('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');

        DB.users[username] = {
            password,
            points: 0,
            videos: []
        };

        // Special users
        if (username === 'mahoodturki630') DB.users[username].points = 10000000;
        if (username === 'mahmoodturki633') DB.users[username].points = 100000000;

        saveDB();
        currentUser = username;
        loginSuccess();
        showToast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    });

    const loginSuccess = () => {
        document.getElementById('authSection').classList.add('d-none');
        document.getElementById('appSection').classList.remove('d-none');
        document.getElementById('usernameDisplay').textContent = currentUser;
        document.getElementById('logoutBtn').classList.remove('d-none');
        updatePointsDisplay();
        renderVideos();

        // Init watched for user
        if (!DB.watched[currentUser]) DB.watched[currentUser] = {};
        saveDB();
    };

    document.getElementById('logoutBtn').addEventListener('click', () => {
        currentUser = null;
        document.getElementById('authSection').classList.remove('d-none');
        document.getElementById('appSection').classList.add('d-none');
        document.getElementById('logoutBtn').classList.add('d-none');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        stopAutoPlay();
    });

    // === Add Video ===
    document.getElementById('addVideoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) return;

        const url = document.getElementById('videoUrl').value.trim();
        const watchTime = parseInt(document.getElementById('watchTime').value);
        const requiredViews = parseInt(document.getElementById('requiredViews').value);

        const videoId = extractYouTubeID(url);
        if (!videoId) return showToast('âŒ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØºÙŠØ± ØµØ§Ù„Ø­');

        const exists = DB.videos.find(v => v.id === videoId && v.owner === currentUser);
        if (exists) return showToast('âš ï¸ Ù„Ù‚Ø¯ Ø£Ø¶ÙØª Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø³Ø¨Ù‚Ø§Ù‹');

        const meta = await fetchYouTubeMeta(videoId);

        const video = {
            id: videoId,
            owner: currentUser,
            url: `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`,
            title: meta.title,
            thumbnail: meta.thumbnail,
            watchTime: watchTime * 60, // seconds
            requiredViews,
            currentViews: 0,
            pointsPerView: Math.floor(watchTime / 5) * 5 // 5 points per 5 min
        };

        DB.videos.push(video);
        if (!DB.users[currentUser].videos) DB.users[currentUser].videos = [];
        DB.users[currentUser].videos.push(videoId);

        saveDB();
        renderVideos();
        showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!');
        e.target.reset();
    });

    // === Render Videos ===
    const renderVideos = () => {
        const grid = document.getElementById('videosGrid');
        grid.innerHTML = '';

        const userWatched = DB.watched[currentUser] || {};

        DB.videos.forEach(video => {
            const isWatched = userWatched[video.id];
            const isOwner = video.owner === currentUser;
            const isSpecial = ['mahoodturki630', 'mahmoodturki633'].includes(video.owner);

            const card = document.createElement('div');
            card.className = 'col-md-4 mb-4';
            card.innerHTML = `
                <div class="card card-video h-100 ${isSpecial ? 'special-user' : ''} ${isOwner ? 'border-primary' : ''}">
                    <img src="${video.thumbnail}" class="card-img-top" alt="${video.title}" style="height: 200px; object-fit: cover;">
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title text-truncate">${video.title}</h6>
                        <p class="text-muted small">
                            <i class="fas fa-user"></i> ${video.owner}
                            ${isSpecial ? '<span class="badge badge-premium ms-2">Ù…Ù…ÙŠØ²</span>' : ''}
                        </p>
                        <p class="small">
                            <i class="fas fa-clock"></i> ${video.watchTime / 60} Ø¯Ù‚ÙŠÙ‚Ø©
                            â€¢ <i class="fas fa-eye"></i> ${video.currentViews}/${video.requiredViews}
                            â€¢ <i class="fas fa-coins"></i> ${video.pointsPerView} Ù†Ù‚Ø·Ø©
                        </p>
                        <button class="btn ${isWatched ? 'btn-secondary' : 'btn-primary'} mt-auto watch-btn" 
                                data-id="${video.id}" ${isWatched || isOwner ? 'disabled' : ''}>
                            ${isWatched ? 'ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©' : 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¢Ù†'}
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });

        // Attach watch buttons
        document.querySelectorAll('.watch-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const videoId = btn.dataset.id;
                const video = DB.videos.find(v => v.id === videoId);
                if (video) startWatching(video);
            });
        });

        updateAutoPlayQueue();
    };

    // === Video Watching ===
    const startWatching = (video) => {
        currentVideoId = video.id;
        requiredTime = video.watchTime;
        startTime = Date.now();

        document.getElementById('modalVideoTitle').textContent = video.title;
        document.getElementById('youtubePlayer').src = video.url;

        const modal = new bootstrap.Modal(document.getElementById('videoModal'));
        modal.show();

        // Timer
        const updateTimer = () => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = requiredTime - elapsed;
            if (remaining <= 0) {
                clearInterval(watchInterval);
                completeWatch(video);
                return;
            }

            const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const secs = (elapsed % 60).toString().padStart(2, '0');
            const totalMins = Math.floor(requiredTime / 60).toString().padStart(2, '0');
            const totalSecs = (requiredTime % 60).toString().padStart(2, '0');

            document.getElementById('timerDisplay').textContent = `${mins}:${secs} / ${totalMins}:${totalSecs}`;
            document.getElementById('watchProgress').style.width = `${(elapsed / requiredTime) * 100}%`;
        };

        watchInterval = setInterval(updateTimer, 500);
        updateTimer();
    };

    const completeWatch = async (video) => {
        // Prevent duplicate
        if (DB.watched[currentUser][video.id]) return;

        DB.watched[currentUser][video.id] = true;
        video.currentViews++;

        // Add points
        const pointsToAdd = video.pointsPerView;
        DB.users[currentUser].points = (DB.users[currentUser].points || 0) + pointsToAdd;

        saveDB();
        updatePointsDisplay();
        renderVideos();

        showToast(`ğŸ‰ ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©! +${pointsToAdd} Ù†Ù‚Ø·Ø©`);

        // Close modal after short delay
        setTimeout(() => {
            bootstrap.Modal.getInstance(document.getElementById('videoModal')).hide();
            document.getElementById('youtubePlayer').src = '';

            // Continue auto play
            if (isAutoPlaying) {
                setTimeout(playNextInQueue, 1000);
            }
        }, 1500);
    };

    // === Auto Play System ===
    const updateAutoPlayQueue = () => {
        const userWatched = DB.watched[currentUser] || {};
        autoPlayQueue = DB.videos.filter(v => 
            v.owner !== currentUser && 
            !userWatched[v.id] && 
            v.currentViews < v.requiredViews
        );
        document.getElementById('remainingCount').textContent = autoPlayQueue.length;
    };

    document.getElementById('autoPlayBtn').addEventListener('click', () => {
        if (autoPlayQueue.length === 0) {
            showToast('â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©');
            return;
        }

        isAutoPlaying = true;
        document.getElementById('autoPlayBtn').classList.add('d-none');
        document.getElementById('stopAutoPlayBtn').classList.remove('d-none');
        document.getElementById('queueCounter').style.display = 'block';
        updateAutoPlayQueue();

        playNextInQueue();
    });

    document.getElementById('stopAutoPlayBtn').addEventListener('click', stopAutoPlay);

    const playNextInQueue = () => {
        if (!isAutoPlaying) return;

        updateAutoPlayQueue();
        if (autoPlayQueue.length === 0) {
            stopAutoPlay();
            showToast('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ! Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§.');
            return;
        }

        const nextVideo = autoPlayQueue[0];
        startWatching(nextVideo);
    };

    const stopAutoPlay = () => {
        isAutoPlaying = false;
        document.getElementById('autoPlayBtn').classList.remove('d-none');
        document.getElementById('stopAutoPlayBtn').classList.add('d-none');
        document.getElementById('queueCounter').style.display = 'none';
        if (watchInterval) clearInterval(watchInterval);
    };

    // Close modal cleanup
    document.getElementById('videoModal').addEventListener('hidden.bs.modal', () => {
        if (watchInterval) clearInterval(watchInterval);
        document.getElementById('youtubePlayer').src = '';
        document.getElementById('watchProgress').style.width = '0%';
        document.getElementById('timerDisplay').textContent = '00:00 / 00:00';
    });

    // === Initial Load ===
    (function init() {
        // Sample videos if empty
        if (DB.videos.length === 0) {
            // Will be empty on first load
        }

        // Auto login if remembered (optional)
        const lastUser = localStorage.getItem('viewSwapLastUser');
        if (lastUser && DB.users[lastUser]) {
            document.getElementById('username').value = lastUser;
            // Don't auto-fill password for security
        }
    })();
</script>
</body>
</html>
