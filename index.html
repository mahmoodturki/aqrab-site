<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProdShareHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: linear-gradient(to bottom, #E3F2FD, #BBDEFB);
            margin: 0;
            padding: 20px;
            color: #263238;
        }
        #header-ad { text-align: center; margin-bottom: 25px; }
        #login-section, #post-section {
            background: #FFFFFF;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            max-width: 600px;
            margin: 0 auto 25px;
            transition: transform 0.3s ease;
        }
        #login-section:hover, #post-section:hover { transform: translateY(-3px); }
        #posts {
            display: flex;
            flex-direction: column;
            gap: 25px;
            max-width: 900px;
            margin: 0 auto;
        }
        .post {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .post:hover { transform: translateY(-5px); }
        .post h3 { color: #26A69A; margin: 0 0 10px; font-weight: 600; }
        .post p { color: #455A64; line-height: 1.6; }
        .images-container { display: flex; flex-wrap: wrap; gap: 12px; }
        .post img { max-width: 160px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        .interaction {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            align-items: center;
        }
        .interaction button {
            background: #26A69A;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s, transform 0.2s;
        }
        .interaction button:hover {
            background: #00796B;
            transform: scale(1.05);
        }
        .stars {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .star {
            font-size: 26px;
            color: #B0BEC5;
            transition: color 0.2s;
        }
        .star.filled { color: #FFD700; }
        .star.half-filled {
            background: linear-gradient(to right, #FFD700 50%, #B0BEC5 50%);
            -webkit-background-clip: text;
            color: transparent;
        }
        .stars:hover .star { color: #FFCA28; }
        #visit-count {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #66BB6A;
            color: #FFFFFF;
            border-radius: 25px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            font-weight: 500;
            z-index: 1000;
        }
        .comment { margin-left: 25px; background: #F5F7FA; padding: 8px 12px; border-radius: 10px; margin-bottom: 8px; color: #455A64; }
        .middle-ad { text-align: center; margin: 25px 0; background: #FFFFFF; padding: 12px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        input, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #B0BEC5;
            border-radius: 10px;
            box-sizing: border-box;
            font-family: 'Poppins', Arial, sans-serif;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus {
            border-color: #26A69A;
            outline: none;
            box-shadow: 0 0 5px rgba(38, 166, 154, 0.3);
        }
        button { cursor: pointer; }
        #logout-btn { background: #EF5350; }
        #logout-btn:hover { background: #D81B60; }
        #user-info { display: flex; align-items: center; gap: 12px; }
        #profile-img { border: 3px solid #26A69A; }
        label { color: #455A64; font-weight: 500; display: block; margin-bottom: 8px; }
        @media (max-width: 600px) {
            body { padding: 15px; }
            .post img { max-width: 120px; }
            #login-section, #post-section { padding: 15px; }
            .interaction button { padding: 8px 16px; }
            #visit-count { padding: 8px 16px; font-size: 14px; }
        }
    </style>
</head>
<body>

<!-- Top Ad -->
<div id="header-ad">
    <script type="text/javascript">
        atOptions = {
            'key' : '2d5deaded3e62ebc9943db8d8b49f74e',
            'format' : 'iframe',
            'height' : 50,
            'width' : 320,
            'params' : {}
        };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js"></script>
</div>

<!-- Login Section -->
<div id="login-section">
    <h2 style="color: #26A69A; font-weight: 600;">Login to ProdShareHub</h2>
    <label for="username">Username</label>
    <input type="text" id="username" placeholder="Enter your username">
    <label for="password">Password</label>
    <input type="password" id="password" placeholder="Enter your password">
    <label for="profile-pic">Profile Picture (optional)</label>
    <input type="file" id="profile-pic" accept="image/*">
    <button onclick="login()">Login / Register</button>
    <button onclick="logout()" id="logout-btn" style="display:none;">Logout</button>
    <div id="user-info" style="display:none; margin-top: 15px;">
        Logged in as: <span id="logged-username" style="color: #26A69A; font-weight: 500;"></span>
        <img id="profile-img" width="50" height="50" style="border-radius:50%;">
    </div>
</div>

<!-- Post Section (visible after login) -->
<div id="post-section" style="display:none;">
    <h2 style="color: #26A69A; font-weight: 600;">Create a Product Post</h2>
    <label for="product-name">Product Name</label>
    <input type="text" id="product-name" placeholder="Enter product name">
    <label for="product-desc">Description</label>
    <textarea id="product-desc" placeholder="Describe your product" rows="4"></textarea>
    <label for="product-images">Product Images (optional)</label>
    <input type="file" id="product-images" multiple accept="image/*">
    <button onclick="createPost()">Post Product</button>
</div>

<!-- Posts Display -->
<div id="posts"></div>

<!-- Visit Count Badge -->
<div id="visit-count">Visits: 0</div>

<script>
    const PREFIX = 'prodsharehub-';
    let users = JSON.parse(localStorage.getItem(PREFIX + 'users')) || {};
    let posts = JSON.parse(localStorage.getItem(PREFIX + 'posts')) || [];
    let currentUser = localStorage.getItem(PREFIX + 'currentUser');
    let visits = parseInt(localStorage.getItem(PREFIX + 'visits')) || 0;

    // Forbidden keywords for moderation (violations like nudity, seduction, crimes, etc.)
    const forbiddenKeywords = [
        'nudity', 'naked', 'porn', 'sex', 'seduction', 'erotic', 'adult',
        'crime', 'murder', 'theft', 'robbery', 'assault', 'violence', 'kill',
        'drugs', 'narcotics', 'illegal', 'weapon', 'bomb', 'explosive',
        'hate', 'racism', 'discrimination', 'terror', 'extremism', 'harassment'
    ]; // Add more as needed; case-insensitive check

    // Increment and display visits
    visits++;
    localStorage.setItem(PREFIX + 'visits', visits);
    document.getElementById('visit-count').innerText = `Visits: ${visits}`;

    // Restore login state
    if (currentUser && users[currentUser]) {
        setCurrentUser(currentUser);
    }

    // Login Function
    function login() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        if (!username || !password) return alert('Please enter username and password');

        const file = document.getElementById('profile-pic').files[0];
        let profilePicPromise = file ? new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = e => resolve(e.target.result);
            reader.readAsDataURL(file);
        }) : Promise.resolve(users[username] ? users[username].profilePic : 'https://via.placeholder.com/50');

        profilePicPromise.then(profilePic => {
            if (users[username]) {
                if (users[username].password !== password) {
                    return alert('Incorrect password');
                }
                if (file) {
                    users[username].profilePic = profilePic;
                }
            } else {
                users[username] = { password, profilePic };
            }
            localStorage.setItem(PREFIX + 'users', JSON.stringify(users));
            setCurrentUser(username);
        });
    }

    // Set Current User
    function setCurrentUser(username) {
        currentUser = username;
        localStorage.setItem(PREFIX + 'currentUser', username);
        document.getElementById('logged-username').innerText = username;
        document.getElementById('profile-img').src = users[username].profilePic;
        document.getElementById('user-info').style.display = 'flex';
        document.getElementById('logout-btn').style.display = 'inline-block';
        document.getElementById('post-section').style.display = 'block';
        document.querySelectorAll('#login-section input, #login-section label, #login-section button:not(#logout-btn)').forEach(el => el.style.display = 'none');
        renderPosts();
    }

    // Logout
    function logout() {
        currentUser = null;
        localStorage.removeItem(PREFIX + 'currentUser');
        document.getElementById('user-info').style.display = 'none';
        document.getElementById('logout-btn').style.display = 'none';
        document.getElementById('post-section').style.display = 'none';
        document.querySelectorAll('#login-section input, #login-section label, #login-section button:not(#logout-btn)').forEach(el => el.style.display = 'block');
        renderPosts();
    }

    // Create Post with Moderation
    function createPost() {
        if (!currentUser) return alert('Please login first');
        const name = document.getElementById('product-name').value.trim();
        const desc = document.getElementById('product-desc').value.trim();
        if (!name || !desc) return alert('Please fill in product name and description');

        // Check for violations
        const lowerDesc = desc.toLowerCase();
        const isViolating = forbiddenKeywords.some(keyword => lowerDesc.includes(keyword));
        if (isViolating) {
            return alert('Post blocked: Content violates community guidelines (e.g., no nudity, crimes, or harmful topics).');
        }

        const images = [];
        const files = document.getElementById('product-images').files;
        const readerPromises = Array.from(files).map(file => {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    images.push(e.target.result);
                    resolve();
                };
                reader.readAsDataURL(file);
            });
        });

        Promise.all(readerPromises).then(() => {
            const post = {
                id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                user: currentUser,
                name,
                desc,
                images,
                likes: 0,
                comments: [],
                shares: 0,
                ratings: [],
                averageRating: 0
            };
            posts.push(post);
            savePosts();
            renderPosts();
            document.getElementById('product-name').value = '';
            document.getElementById('product-desc').value = '';
            document.getElementById('product-images').value = '';
        });
    }

    // Save Posts
    function savePosts() {
        localStorage.setItem(PREFIX + 'posts', JSON.stringify(posts));
    }

    // Render Posts with Sorting
    function renderPosts() {
        posts.sort((a, b) => (b.likes + b.comments.length + b.shares) - (a.likes + a.comments.length + a.shares));
        const container = document.getElementById('posts');
        container.innerHTML = '';

        posts.forEach((post, index) => {
            const avg = post.averageRating;
            const fullStars = Math.floor(avg);
            const halfStar = avg % 1 >= 0.5 ? 1 : 0;

            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            postDiv.innerHTML = `
                <h3>${post.name}</h3>
                <p>${post.desc}</p>
                <div class="images-container">${post.images.map(img => `<img src="${img}" alt="Product Image">`).join('')}</div>
                <div class="interaction">
                    <button onclick="likePost('${post.id}')">Like (${post.likes})</button>
                    <button onclick="sharePost('${post.id}')">Share (${post.shares})</button>
                    <div class="stars" data-post-id="${post.id}">
                        Rating: ${avg.toFixed(1)} / 5
                        ${[1,2,3,4,5].map(i => {
                            let className = 'star';
                            if (i <= fullStars) className += ' filled';
                            else if (i === fullStars + 1 && halfStar) className += ' half-filled';
                            return `<span class="${className}" onclick="ratePost('${post.id}', ${i})">â˜…</span>`;
                        }).join('')}
                    </div>
                </div>
                <div>Comments (${post.comments.length}):</div>
                <div id="comments-${post.id}">${post.comments.map(c => `<div class="comment">${c}</div>`).join('')}</div>
                <input type="text" id="comment-input-${post.id}" placeholder="Add a comment...">
                <button onclick="addComment('${post.id}')">Comment</button>
            `;
            container.appendChild(postDiv);

            if ((index + 1) % 3 === 0) {
                const adDiv = document.createElement('div');
                adDiv.className = 'middle-ad';
                const script1 = document.createElement('script');
                script1.type = 'text/javascript';
                script1.innerHTML = `atOptions = {'key' : '2d5deaded3e62ebc9943db8d8b49f74e','format' : 'iframe','height' : 50,'width' : 320,'params' : {}};`;
                adDiv.appendChild(script1);
                const script2 = document.createElement('script');
                script2.type = 'text/javascript';
                script2.src = '//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js';
                adDiv.appendChild(script2);
                container.appendChild(adDiv);
            }
        });
    }

    // Like Post
    function likePost(id) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.likes++;
            savePosts();
            renderPosts();
        }
    }

    // Share Post (copies hidden link)
    function sharePost(id) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.shares++;
            const link = window.location.origin + window.location.pathname + '#' + id;
            navigator.clipboard.writeText(link).then(() => alert('Link copied to clipboard! Share it anywhere.'));
            savePosts();
            renderPosts();
        }
    }

    // Rate Post
    function ratePost(id, rating) {
        if (!currentUser) return alert('Please login to interact');
        const post = posts.find(p => p.id === id);
        if (post) {
            post.ratings.push(rating);
            post.averageRating = post.ratings.reduce((a, b) => a + b, 0) / post.ratings.length;
            savePosts();
            renderPosts();
        }
    }

    // Add Comment
    function addComment(id) {
        if (!currentUser) return alert('Please login to interact');
        const input = document.getElementById(`comment-input-${id}`);
        const comment = input.value.trim();
        if (!comment) return;
        const post = posts.find(p => p.id === id);
        if (post) {
            post.comments.push(comment);
            input.value = '';
            savePosts();
            renderPosts();
        }
    }

    // Initial Render
    renderPosts();
</script>

</body>
</html>
