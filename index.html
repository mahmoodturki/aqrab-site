<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ShopHub - Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</title>
<style>
  body {font-family: "Tajawal", sans-serif; background: #f5f5f5; margin: 0; padding: 0;}
  header {
    background: #fff; border-bottom: 1px solid #ddd; padding: 10px 20px;
    display: flex; justify-content: space-between; align-items: center;
    position: sticky; top: 0; z-index: 10;
  }
  .title {font-size: 22px; font-weight: bold; color: #0070f3;}
  #visitorCounter {color: #555; font-size: 14px;}
  #userInfo {display: flex; align-items: center; gap: 10px;}
  #userInfo img {width: 35px; height: 35px; border-radius: 50%; object-fit: cover;}
  main {max-width: 750px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);}
  input[type="text"], input[type="file"], textarea {width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 10px;}
  button {background-color: #0070f3; color: #fff; border: none; padding: 7px 14px; border-radius: 6px; cursor: pointer;}
  button:hover {background-color: #0059c9;}
  .login-box, .new-post {margin-bottom: 20px; background: #fafafa; padding: 15px; border-radius: 8px;}
  .post {border-bottom: 1px solid #eee; padding: 15px 0;}
  .post:last-child {border-bottom: none;}
  .post h3 {margin: 0; color: #111;}
  .post img.post-image {width: 100%; border-radius: 8px; margin: 8px 0; object-fit: cover; max-height: 400px;}
  .actions button {background: none; border: none; color: #0070f3; cursor: pointer; margin-inline-end: 10px; font-size: 14px;}
  .rating span {font-size: 22px; cursor: pointer; color: #ccc;}
  .rating span.active {color: gold;}
  .comment-box {margin-top: 8px;}
  .comments p {background: #f2f2f2; padding: 5px; border-radius: 6px;}
  #profilePreview {display: none; margin-bottom: 10px; width: 60px; height: 60px; border-radius: 50%; object-fit: cover;}
  footer {text-align: center; color: #888; margin: 20px;}
</style>
</head>
<body>

<header>
  <div class="title">ShopHub</div>
  <div id="visitorCounter">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: <span id="visitCount">0</span></div>
  <div id="userInfo">
    <span id="usernameLabel">Ø§Ù„Ø²Ø§Ø¦Ø±</span>
    <img id="userImage" src="https://via.placeholder.com/35" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <button id="logoutBtn" style="display:none;">Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<main>
  <div class="login-box" id="loginBox">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <img id="profilePreview" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©">
    <input type="text" id="usernameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="file" id="profileImageInput" accept="image/*">
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div class="new-post" id="newPostBox" style="display:none;">
    <h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
    <input type="text" id="postTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <textarea id="postDescription" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬"></textarea>
    <input type="file" id="postImage" accept="image/*">
    <button id="createBtn">Ù†Ø´Ø±</button>
  </div>

  <div id="posts"></div>
</main>

<footer>Â© 2025 ShopHub</footer>

<script>
  // === Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª ===
  let visits = parseInt(localStorage.getItem("visitCount") || "0");
  visits++;
  localStorage.setItem("visitCount", visits);
  document.getElementById("visitCount").textContent = visits;

  // === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ===
  let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
  let posts = JSON.parse(localStorage.getItem("posts")) || [];

  function updateUI() {
    const loginBox = document.getElementById("loginBox");
    const newPostBox = document.getElementById("newPostBox");
    const logoutBtn = document.getElementById("logoutBtn");
    const usernameLabel = document.getElementById("usernameLabel");
    const userImage = document.getElementById("userImage");

    if (currentUser) {
      usernameLabel.textContent = currentUser.name;
      userImage.src = currentUser.image;
      loginBox.style.display = "none";
      newPostBox.style.display = "block";
      logoutBtn.style.display = "inline-block";
    } else {
      usernameLabel.textContent = "Ø§Ù„Ø²Ø§Ø¦Ø±";
      userImage.src = "https://via.placeholder.com/35";
      loginBox.style.display = "block";
      newPostBox.style.display = "none";
      logoutBtn.style.display = "none";
    }
  }

  // === ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===
  document.getElementById("loginBtn").onclick = function() {
    const name = document.getElementById("usernameInput").value.trim();
    const file = document.getElementById("profileImageInput").files[0];
    if (!name) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");

    const saveUser = (img) => {
      currentUser = { name, image: img || "https://via.placeholder.com/35" };
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      updateUI();
    };

    if (file) {
      const reader = new FileReader();
      reader.onload = e => saveUser(e.target.result);
      reader.readAsDataURL(file);
    } else saveUser();
  };

  document.getElementById("logoutBtn").onclick = function() {
    localStorage.removeItem("currentUser");
    currentUser = null;
    updateUI();
  };

  // === Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± ===
  document.getElementById("createBtn").onclick = function() {
    if (!currentUser) return alert("Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    const title = document.getElementById("postTitle").value.trim();
    const desc = document.getElementById("postDescription").value.trim();
    const file = document.getElementById("postImage").files[0];
    if (!title || !desc) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙˆØµÙ");

    const finalizePost = (image) => {
      const id = "post-" + Date.now();
      const newPost = {
        id, title, desc,
        image: image || "",
        user: currentUser.name,
        userImage: currentUser.image,
        likes: [], comments: [], rating: 0, ratingCount: 0, followers: [],
        link: location.origin + "/#" + id
      };
      posts.unshift(newPost);
      localStorage.setItem("posts", JSON.stringify(posts));
      renderPosts();
      document.getElementById("postTitle").value = "";
      document.getElementById("postDescription").value = "";
      document.getElementById("postImage").value = "";
      alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
    };

    if (file) {
      const reader = new FileReader();
      reader.onload = e => finalizePost(e.target.result);
      reader.readAsDataURL(file);
    } else finalizePost("");
  };

  // === Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ===
  function renderPosts() {
    const container = document.getElementById("posts");
    container.innerHTML = "";
    posts.forEach(post => {
      const avg = post.ratingCount ? Math.round(post.rating / post.ratingCount) : 0;
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <div style="display:flex; align-items:center; gap:8px;">
          <img src="${post.userImage}" width="40" height="40" style="border-radius:50%;">
          <strong>${post.user}</strong>
          ${
            currentUser && post.user !== currentUser.name
            ? `<button onclick="followUser('${post.id}')">Ù…ØªØ§Ø¨Ø¹Ø© (${post.followers.length})</button>`
            : `<span style="color:#777;">Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙˆÙ†: ${post.followers.length}</span>`
          }
        </div>
        <h3>${post.title}</h3>
        <p>${post.desc}</p>
        ${post.image ? `<img src="${post.image}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" class="post-image">` : ""}
        <div class="actions">
          <button onclick="likePost('${post.id}')">â¤ï¸ ${post.likes.length}</button>
          <button onclick="copyLink('${post.id}')">ğŸ”— Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        </div>
        <div class="rating">
          ${[1,2,3,4,5].map(i => `<span onclick="ratePost('${post.id}',${i})" class="${i<=avg?'active':''}">&#9733;</span>`).join("")}
        </div>
        <div class="comment-box">
          <input type="text" id="comment-${post.id}" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ù‹Ø§...">
          <button onclick="addComment('${post.id}')">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <div class="comments">
          ${post.comments.map(c => `<p><strong>${c.user}</strong>: ${c.text}</p>`).join("")}
        </div>
      `;
      container.appendChild(div);
    });
  }

  // === Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ===
  function likePost(id) {
    if (!currentUser) return alert("Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    const post = posts.find(p => p.id === id);
    const i = post.likes.indexOf(currentUser.name);
    if (i === -1) post.likes.push(currentUser.name); else post.likes.splice(i, 1);
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }

  function addComment(id) {
    const input = document.getElementById(`comment-${id}`);
    const text = input.value.trim();
    if (!text || !currentUser) return;
    const post = posts.find(p => p.id === id);
    post.comments.push({ user: currentUser.name, text });
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }

  function ratePost(id, stars) {
    const post = posts.find(p => p.id === id);
    post.rating += stars;
    post.ratingCount++;
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }

  function followUser(id) {
    const post = posts.find(p => p.id === id);
    if (!currentUser) return alert("Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    if (post.followers.includes(currentUser.name))
      post.followers = post.followers.filter(f => f !== currentUser.name);
    else post.followers.push(currentUser.name);
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }

  function copyLink(id) {
    const post = posts.find(p => p.id === id);
    navigator.clipboard.writeText(post.link);
    alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!");
  }

  updateUI();
  renderPosts();
</script>

</body>
</html>
