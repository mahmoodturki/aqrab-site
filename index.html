<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ShowcaseHub â€” Ù…Ù†ØµØ© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#06b6d4;
      --error:#ef4444;
      --success:#10b981;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif;
      background:linear-gradient(180deg,#071428 0%, #071a2a 100%);
      color:#e6eef6;
    }
    
    /* layout */
    header{
      position:fixed;
      top:0;
      left:0;
      right:0;
      height:64px;
      background:rgba(2,6,23,0.6);
      backdrop-filter:blur(6px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 16px;
      z-index:50;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    
    .logo{
      width:44px;
      height:44px;
      border-radius:8px;
      background:linear-gradient(135deg,var(--accent),#7c3aed);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color: white;
    }
    
    main{
      max-width:960px;
      margin:88px auto;
      padding:16px;
    }
    
    .compose, .controls{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      padding:14px;
      border-radius:12px;
      margin-bottom: 16px;
    }
    
    .compose textarea{
      width:100%;
      min-height:80px;
      background:transparent;
      border:0;
      color:inherit;
      resize:vertical;
      font-family: inherit;
    }
    
    .row{
      display:flex;
      gap:8px;
      align-items:center;
    }
    
    .btn{
      background:var(--accent);
      border:0;
      color:#032;
      cursor:pointer;
      padding:8px 12px;
      border-radius:8px;
      font-weight:600;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    
    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    .btn.ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
    }
    
    .btn.ghost:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .profile-input{
      display:flex;
      gap:8px;
      align-items:center;
    }
    
    .posts{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:12px;
    }
    
    .post{
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.04);
      transition: all 0.3s ease;
    }
    
    .post:hover {
      border-color: rgba(255,255,255,0.08);
      transform: translateY(-2px);
    }
    
    .post .meta{
      display:flex;
      align-items:center;
      gap:12px;
    }
    
    .avatar{
      width:44px;
      height:44px;
      border-radius:50%;
      background:#0e1622;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      flex-shrink: 0;
      overflow: hidden;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .media{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    
    .media img, .media video{
      max-width:100%;
      border-radius:8px;
      max-height: 300px;
      object-fit: cover;
    }
    
    .actions{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    
    .stat{
      opacity:0.9;
      font-size:14px;
    }
    
    .center-ad{
      display:flex;
      justify-content:center;
      padding:12px;
    }
    
    /* modals */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(2,6,23,0.6);
      z-index:100;
      padding: 16px;
    }
    
    .modal.open{
      display:flex;
    }
    
    .card{
      background:linear-gradient(180deg,#071323,#07142a);
      padding:16px;
      border-radius:12px;
      min-width:320px;
      max-width:720px;
      width: 100%;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    input, textarea, select {
      background:transparent;
      border:1px solid rgba(255,255,255,0.08);
      padding:8px;
      border-radius:8px;
      color:inherit;
      width:100%;
      font-family: inherit;
      margin-bottom: 8px;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .muted{
      color:var(--muted);
      font-size:13px;
    }
    
    footer{
      max-width:960px;
      margin:24px auto;
      color:var(--muted);
      text-align:center;
      padding: 0 16px;
    }
    
    .error {
      color: var(--error);
      font-size: 14px;
      margin-top: 4px;
    }
    
    .success {
      color: var(--success);
      font-size: 14px;
      margin-top: 4px;
    }
    
    .notification {
      position: fixed;
      top: 80px;
      right: 16px;
      padding: 12px 16px;
      border-radius: 8px;
      background: var(--success);
      color: white;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: none;
    }
    
    .notification.error {
      background: var(--error);
    }
    
    @media(min-width:980px){
      .media img, .media video{
        max-width:48%;
      }
    }
    
    @media(max-width: 768px) {
      header {
        padding: 8px;
      }
      
      .brand > div:last-child .muted {
        display: none;
      }
      
      .row {
        flex-wrap: wrap;
      }
      
      .controls .row {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
  <div class="notification" id="notification"></div>

  <!-- Ø«Ø§Ø¨Øª Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©: Ø¥Ø¹Ù„Ø§Ù† -->
  <div style="position:fixed;top:64px;left:0;right:0;display:flex;justify-content:center;z-index:60;padding:6px;background:transparent">
    <!-- Ad snippet (top fixed) -->
    <div id="top-ad">
      <script type="text/javascript"> atOptions = { 'key' : '2d5deaded3e62ebc9943db8d8b49f74e', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} }; </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js"></script>
    </div>
  </div>

  <header>
    <div class="brand">
      <div class="logo">SH</div>
      <div>
        <div style="font-weight:700">ShowcaseHub</div>
        <div class="muted">Ø¹Ø±Ø¶ ÙˆØ¨ÙŠØ¹ â€” Ø§Ù†Ø´Ø± ØµÙˆØ±ØŒ Ù†ØµØŒ ÙÙŠØ¯ÙŠÙˆØŒ Ø±ÙˆØ§Ø¨Ø· ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>
      </div>
    </div>
    <div class="row">
      <div class="muted" id="visitCounter">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: 0</div>
      <button class="btn" id="openCompose">Ø§Ù†Ø´Ø± Ù…Ù†ØªØ¬</button>
      <button class="btn ghost" id="openLogin">ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</button>
    </div>
  </header>

  <main>
    <section class="controls">
      <div class="row" style="justify-content:space-between">
        <div>
          <strong id="welcomeText">Ù…Ø±Ø­Ø¨Ø§Ù‹ â€” Ø²Ø§Ø¦Ø±</strong>
          <div class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
        </div>
        <div class="row">
          <button class="btn ghost" id="btnProfile">Ù…Ù„ÙÙŠ</button>
          <button class="btn ghost" id="btnLogout" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
    </section>

    <section class="compose">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Ø§Ù†Ø¸Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ø£Ø¨Ø±Ø² Ø£ÙˆÙ„Ø§Ù‹ â€” Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ù…Ø¯Ù…Ø¬Ø©</strong><div class="muted">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªÙØ§Ø¹Ù„ (Ù„Ø§ÙŠÙƒØŒ ØªØ¹Ù„ÙŠÙ‚ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø±) + Ø¹Ø§Ù…Ù„ Ø§Ù„Ø²Ù…Ù†</div></div>
        <div class="muted">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­: <strong>ShowcaseHub</strong></div>
      </div>
      <div class="posts" id="posts"></div>
    </section>

  </main>

  <!-- Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø³ÙŠØ¸Ù‡Ø± ÙˆØ³Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙØ­) -->
  <div class="center-ad" id="midAdContainer"></div>

  <footer>
    <div>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø­Ø§ÙƒØ§Ø© â€” Ù‡Ø°Ø§ Ù…Ù„Ù Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ·ÙˆÙŠØ±. Ù…Ù…ÙŠØ²Ø§Øª Ù…Ù‡Ù…Ø© Ù…Ø¶Ø§ÙØ©: ØªØ³Ø¬ÙŠÙ„ØŒ Ù†Ø´Ø± ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆØŒ Ø±ÙˆØ§Ø¨Ø·ØŒ Ù‡Ø§ØªÙØŒ ØªÙØ§Ø¹Ù„ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø±ØŒ Ø±Ø§Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠ Ù„ÙƒÙ„ Ù…Ù†Ø´ÙˆØ±ØŒ Ø¹Ø¯Ø§Ø¯ Ø²ÙŠØ§Ø±Ø§ØªØŒ Ø¨Ø±ÙˆÙØ§ÙŠÙ„.</div>
  </footer>

  <!-- Modals -->
  <div class="modal" id="modalCompose">
    <div class="card">
      <h3>Ø§Ù†Ø´Ø± Ù…Ù†ØªØ¬ Ø£Ùˆ Ù…Ù†Ø´ÙˆØ±</h3>
      <div class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù†ØµØŒ ØµÙˆØ±ØŒ ÙÙŠØ¯ÙŠÙˆØŒ Ø±Ø§Ø¨Ø·ØŒ Ù‡Ø§ØªÙØŒ ÙˆØµÙ ÙˆØ³Ø¹Ø±</div>
      <div style="margin-top:8px">
        <input id="postTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
        <textarea id="postDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ / Ø§Ù„Ù…Ù†Ø´ÙˆØ±"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="postPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
          <input id="postLink" placeholder="Ø±Ø§Ø¨Ø· ØªÙˆØ§ØµÙ„ / ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬ (https://...)" />
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="postPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
          <select id="postVisibility"><option value="public">Ø¹Ø§Ù…Ø©</option><option value="private">Ø®Ø§ØµØ©</option></select>
        </div>
        <div style="margin-top:8px">
          <label class="muted">Ø£Ø¶Ù Ù…Ù„ÙØ§Øª (ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ) â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ù…ØªØ¹Ø¯Ø¯Ø©</label>
          <input id="postFiles" type="file" multiple accept="image/*,video/*" />
          <div class="muted">ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø± ØµÙˆØ± ÙÙ‚Ø· Ø£Ùˆ Ù†Øµ ÙÙ‚Ø· Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ø£ÙŠ Ù…Ø²ÙŠØ¬</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
          <button class="btn ghost" id="closeCompose">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="submitPost">Ù†Ø´Ø±</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalLogin">
    <div class="card">
      <h3 id="loginTitle">ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</h3>
      <div class="muted">Ù†Ø¸Ø§Ù… Ù…ØµØºØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø© â€” Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹ (localStorage). Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… ÙƒÙ„Ù…Ø§Øª Ø³Ø± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ§Ø¬.</div>
      <div style="margin-top:8px">
        <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
        <input id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password" />
        <div id="loginError" class="error" style="display:none"></div>
        <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
          <button class="btn ghost" id="closeLogin">Ø¥ØºÙ„Ø§Ù‚</button>
          <button class="btn" id="doRegister">ØªØ³Ø¬ÙŠÙ„</button>
          <button class="btn" id="doLogin">Ø¯Ø®ÙˆÙ„</button>
        </div>
        <div style="margin-top:6px" class="muted">Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalProfile">
    <div class="card">
      <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
      <div class="muted">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
      <div style="margin-top:8px">
        <input id="profileName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶" />
        <input id="profilePic" type="file" accept="image/*" />
        <textarea id="profileBio" placeholder="Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button class="btn ghost" id="closeProfile">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveProfile">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /******************************************************************
     * ShowcaseHub - single-file demo
     * - Suggested English name: ShowcaseHub
     * - Data persistence: localStorage (for demo). Replace with server & DB for prod.
     * - Authentication: simple user objects stored locally (NOT secure). Replace with real backend.
     * - Algorithm: posts are sorted by a computed score = likes*2 + comments*3 + shares*4 + freshnessBonus
     * - Each post has permalink: #post-{id}
     * - Ads: user provided scripts are included at top and mid-feed
     ******************************************************************/

    // Simple helpers
    const $ = id => document.getElementById(id);

    // Site visits counter
    let visits = parseInt(localStorage.getItem('siteVisits')) || 0;
    visits++;
    localStorage.setItem('siteVisits', visits);
    $('visitCounter').textContent = 'Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ' + visits;

    // Current session user
    let currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');

    // Storage keys
    const KEY_USERS = 'sh_users';
    const KEY_POSTS = 'sh_posts';

    // Load objects
    function loadUsers() {
      return JSON.parse(localStorage.getItem(KEY_USERS) || '{}');
    }
    
    function saveUsers(u) {
      localStorage.setItem(KEY_USERS, JSON.stringify(u));
    }
    
    function loadPosts() {
      return JSON.parse(localStorage.getItem(KEY_POSTS) || '[]');
    }
    
    function savePosts(p) {
      localStorage.setItem(KEY_POSTS, JSON.stringify(p));
    }

    // Show notification
    function showNotification(message, isError = false) {
      const notification = $('notification');
      notification.textContent = message;
      notification.className = isError ? 'notification error' : 'notification';
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // UI refs
    const postsEl = $('posts');

    // Basic auth (localStorage) â€” for demo only
    $('openLogin').addEventListener('click', () => openModal('modalLogin'));
    $('closeLogin').addEventListener('click', () => closeModal('modalLogin'));
    
    $('doRegister').addEventListener('click', () => {
      const u = $('username').value.trim();
      const p = $('password').value;
      
      if (!u || !p) {
        showNotification('Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
        return;
      }
      
      if (u.length < 3) {
        showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', true);
        return;
      }
      
      if (p.length < 3) {
        showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', true);
        return;
      }
      
      const users = loadUsers();
      if (users[u]) {
        showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹', true);
        return;
      }
      
      users[u] = {
        password: btoa(p),
        name: u,
        avatar: null,
        bio: ''
      };
      
      saveUsers(users);
      showNotification('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
      $('username').value = '';
      $('password').value = '';
    });
    
    $('doLogin').addEventListener('click', () => {
      const u = $('username').value.trim();
      const p = $('password').value;
      const users = loadUsers();
      
      if (!users[u] || users[u].password !== btoa(p)) {
        showNotification('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', true);
        return;
      }
      
      currentUser = {
        username: u,
        name: users[u].name,
        avatar: users[u].avatar,
        bio: users[u].bio
      };
      
      sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
      updateAuthUI();
      closeModal('modalLogin');
      showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name || currentUser.username}!`);
      $('username').value = '';
      $('password').value = '';
    });

    function updateAuthUI() {
      if (currentUser) {
        $('welcomeText').textContent = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ' + (currentUser.name || currentUser.username);
        $('btnLogout').style.display = 'inline-block';
        $('openLogin').style.display = 'none';
      } else {
        $('welcomeText').textContent = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ â€” Ø²Ø§Ø¦Ø±';
        $('btnLogout').style.display = 'none';
        $('openLogin').style.display = 'inline-block';
      }
    }

    $('btnLogout').addEventListener('click', () => {
      sessionStorage.removeItem('currentUser');
      currentUser = null;
      updateAuthUI();
      showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
    });

    // Profile modal
    $('btnProfile').addEventListener('click', () => {
      if (!currentUser) {
        showNotification('Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true);
        openModal('modalLogin');
        return;
      }
      
      const users = loadUsers();
      const u = users[currentUser.username];
      $('profileName').value = u.name || currentUser.username;
      $('profileBio').value = u.bio || '';
      $('profilePic').value = '';
      openModal('modalProfile');
    });
    
    $('closeProfile').addEventListener('click', () => closeModal('modalProfile'));
    
    $('saveProfile').addEventListener('click', () => {
      const name = $('profileName').value.trim();
      const bio = $('profileBio').value.trim();
      const file = $('profilePic').files[0];
      const users = loadUsers();
      const u = users[currentUser.username];
      
      if (!name) {
        showNotification('Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨', true);
        return;
      }
      
      u.name = name;
      u.bio = bio;
      
      if (file) {
        const r = new FileReader();
        r.onload = () => {
          u.avatar = r.result;
          users[currentUser.username] = u;
          saveUsers(users);
          currentUser = {
            username: currentUser.username,
            name: u.name,
            avatar: u.avatar,
            bio: u.bio
          };
          sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
          updateAuthUI();
          closeModal('modalProfile');
          renderPosts();
          showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
        };
        r.readAsDataURL(file);
      } else {
        users[currentUser.username] = u;
        saveUsers(users);
        currentUser = {
          username: currentUser.username,
          name: u.name,
          avatar: u.avatar,
          bio: u.bio
        };
        sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateAuthUI();
        closeModal('modalProfile');
        renderPosts();
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
      }
    });

    // Compose modal
    $('openCompose').addEventListener('click', () => {
      if (!currentUser) {
        showNotification('Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true);
        openModal('modalLogin');
        return;
      }
      openModal('modalCompose');
    });
    
    $('closeCompose').addEventListener('click', () => closeModal('modalCompose'));

    // Submit post
    $('submitPost').addEventListener('click', async () => {
      const title = $('postTitle').value.trim();
      const desc = $('postDesc').value.trim();
      const phone = $('postPhone').value.trim();
      const link = $('postLink').value.trim();
      const price = $('postPrice').value.trim();
      const files = Array.from($('postFiles').files);
      
      if (!desc && files.length === 0) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ Ø£Ùˆ Ù…Ù„Ù ÙˆØ³Ø§Ø¦Ø·', true);
        return;
      }
      
      const media = [];
      // read files to data URLs
      for (const f of files) {
        const d = await fileToDataURL(f);
        media.push({
          type: f.type.startsWith('video') ? 'video' : 'image',
          data: d,
          name: f.name
        });
      }
      
      const posts = loadPosts();
      const id = 'p_' + Date.now() + '_' + Math.random().toString(36).slice(2, 8);
      const post = {
        id,
        author: currentUser.username,
        authorName: currentUser.name,
        authorAvatar: currentUser.avatar,
        title,
        desc,
        phone,
        link,
        price,
        media,
        createdAt: Date.now(),
        likes: 0,
        comments: [],
        shares: 0,
        views: 0
      };
      
      posts.push(post);
      savePosts(posts);
      closeModal('modalCompose');
      clearComposeForm();
      renderPosts();
      showNotification('ØªÙ… Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
      
      // navigate to permalink
      location.hash = 'post-' + id;
    });

    function clearComposeForm() {
      ['postTitle', 'postDesc', 'postPhone', 'postLink', 'postPrice'].forEach(i => $(i).value = '');
      $('postFiles').value = null;
    }

    function fileToDataURL(file) {
      return new Promise(res => {
        const r = new FileReader();
        r.onload = () => res(r.result);
        r.readAsDataURL(file);
      });
    }

    // Render posts with algorithmic sorting
    function computeScore(post) {
      const ageHours = (Date.now() - post.createdAt) / 36e5;
      const freshness = Math.max(0, 72 - ageHours); // recent 72 hours bonus
      return (post.likes || 0) * 2 + (post.comments ? post.comments.length * 3 : 0) + (post.shares || 0) * 4 + freshness;
    }

    function renderPosts() {
      const posts = loadPosts();
      // sort by score desc
      posts.sort((a, b) => computeScore(b) - computeScore(a) || b.createdAt - a.createdAt);
      postsEl.innerHTML = '';
      
      // We'll insert a mid-feed ad after 3 posts
      posts.forEach((p, idx) => {
        const el = document.createElement('div');
        el.className = 'post';
        el.id = 'post-' + p.id;
        
        el.innerHTML = `
          <div class="meta">
            <div class="avatar">${p.authorAvatar ? ('<img src="' + p.authorAvatar + '" alt="' + (p.authorName || p.author) + '">') : (p.authorName ? p.authorName[0].toUpperCase() : 'U')}</div>
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div><strong>${escapeHtml(p.title || '')}</strong><div class="muted">Ø¨ÙˆØ§Ø³Ø·Ø© ${escapeHtml(p.authorName || p.author)} Â· ${timeAgo(p.createdAt)}</div></div>
                <div class="muted">${p.price ? ('Ø§Ù„Ø³Ø¹Ø±: ' + escapeHtml(p.price)) : ''}</div>
              </div>
              <div style="margin-top:8px">${escapeHtml(p.desc || '')}</div>
              ${p.phone ? '<div class="muted">Ø§Ù„Ù‡Ø§ØªÙ: ' + escapeHtml(p.phone) + '</div>' : ''}
              ${p.link ? '<div class="muted">Ø§Ù„Ø±Ø§Ø¨Ø·: <a href="' + escapeHtml(p.link) + '" target="_blank" style="color: var(--accent);">' + escapeHtml(p.link) + '</a></div>' : ''}
            </div>
          </div>
        `;
        
        // media
        if (p.media && p.media.length) {
          const mediaWrap = document.createElement('div');
          mediaWrap.className = 'media';
          p.media.forEach(m => {
            if (m.type === 'image') {
              const i = document.createElement('img');
              i.src = m.data;
              i.alt = m.name;
              mediaWrap.appendChild(i);
            } else {
              const v = document.createElement('video');
              v.src = m.data;
              v.controls = true;
              v.preload = 'metadata';
              mediaWrap.appendChild(v);
            }
          });
          el.appendChild(mediaWrap);
        }

        // actions
        const actions = document.createElement('div');
        actions.className = 'actions';
        
        const likeBtn = document.createElement('button');
        likeBtn.className = 'btn ghost';
        likeBtn.textContent = 'ğŸ‘ ' + (p.likes || 0);
        likeBtn.addEventListener('click', () => {
          if (!currentUser) {
            showNotification('Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true);
            openModal('modalLogin');
            return;
          }
          p.likes = (p.likes || 0) + 1;
          savePost(p);
          renderPosts();
        });
        
        const commentBtn = document.createElement('button');
        commentBtn.className = 'btn ghost';
        commentBtn.textContent = 'ğŸ’¬ ' + (p.comments ? p.comments.length : 0);
        commentBtn.addEventListener('click', () => {
          if (!currentUser) {
            showNotification('Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true);
            openModal('modalLogin');
            return;
          }
          const txt = prompt('Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ:');
          if (txt) {
            p.comments = p.comments || [];
            p.comments.push({
              user: currentUser.username,
              text: txt,
              at: Date.now()
            });
            savePost(p);
            renderPosts();
          }
        });
        
        const shareBtn = document.createElement('button');
        shareBtn.className = 'btn ghost';
        shareBtn.textContent = 'ğŸ” ' + (p.shares || 0);
        shareBtn.addEventListener('click', () => {
          p.shares = (p.shares || 0) + 1;
          savePost(p);
          // copy link
          const link = location.origin + location.pathname + '#post-' + p.id;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(link).then(() => {
              showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·: ' + link);
            });
          } else {
            showNotification('Ø§Ù„Ø±Ø§Ø¨Ø·: ' + link);
          }
          renderPosts();
        });
        
        const permalink = document.createElement('button');
        permalink.className = 'btn ghost';
        permalink.textContent = 'ğŸ”— Ø±Ø§Ø¨Ø·';
        permalink.addEventListener('click', () => {
          location.hash = 'post-' + p.id;
          showNotification('ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø¦Ù…');
        });
        
        const repostBtn = document.createElement('button');
        repostBtn.className = 'btn ghost';
        repostBtn.textContent = 'â†©ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø±';
        repostBtn.addEventListener('click', () => {
          if (!currentUser) {
            showNotification('Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true);
            openModal('modalLogin');
            return;
          }
          const posts = loadPosts();
          const nid = 'p_' + Date.now() + '_' + Math.random().toString(36).slice(2, 8);
          const newp = JSON.parse(JSON.stringify(p));
          newp.id = nid;
          newp.createdAt = Date.now();
          newp.author = currentUser.username;
          newp.authorName = currentUser.name;
          newp.authorAvatar = currentUser.avatar;
          newp.likes = 0;
          newp.comments = [];
          newp.shares = 0;
          posts.push(newp);
          savePosts(posts);
          renderPosts();
          showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­');
        });

        actions.appendChild(likeBtn);
        actions.appendChild(commentBtn);
        actions.appendChild(shareBtn);
        actions.appendChild(repostBtn);
        actions.appendChild(permalink);
        el.appendChild(actions);

        // show comments preview
        if (p.comments && p.comments.length) {
          const cwrap = document.createElement('div');
          cwrap.className = 'muted';
          cwrap.style.marginTop = '8px';
          cwrap.innerHTML = '<strong>ØªØ¹Ù„ÙŠÙ‚Ø§Øª: </strong>' + p.comments.slice(-3).map(c => escapeHtml((c.user || '') + ': ' + c.text)).join(' | ');
          el.appendChild(cwrap);
        }

        // count views when rendered in feed (simple impression)
        p.views = (p.views || 0) + 1;
        savePost(p);

        postsEl.appendChild(el);
        
        // Insert mid-feed ad after third item
        if (idx === 2) {
          const adc = $('midAdContainer');
          if (adc) {
            adc.innerHTML = `<div style="width:320px;height:50px;">
              <script type="text/javascript"> 
                atOptions = { 
                  'key' : '2d5deaded3e62ebc9943db8d8b49f74e', 
                  'format' : 'iframe', 
                  'height' : 50, 
                  'width' : 320, 
                  'params' : {} 
                }; 
              <\/script>
              <script type="text/javascript" src="//www.highperformanceformat.com/2d5deaded3e62ebc9943db8d8b49f74e/invoke.js"><\/script>
            </div>`;
          }
        }
      });

      // update visit count display
      $('visitCounter').textContent = 'Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ' + localStorage.getItem('siteVisits');
    }

    function savePost(p) {
      const posts = loadPosts();
      const ix = posts.findIndex(x => x.id === p.id);
      if (ix >= 0) {
        posts[ix] = p;
      } else {
        posts.push(p);
      }
      savePosts(posts);
    }

    // utils
    function openModal(id) {
      $(id).classList.add('open');
    }
    
    function closeModal(id) {
      $(id).classList.remove('open');
    }
    
    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/&/g, '&amp;')
             .replace(/</g, '&lt;')
             .replace(/>/g, '&gt;')
             .replace(/"/g, '&quot;')
             .replace(/'/g, '&#039;');
    }
    
    function timeAgo(ts) {
      const d = Date.now() - ts;
      const s = Math.floor(d / 1000);
      if (s < 60) return s + ' Ø«Ø§Ù†ÙŠØ©';
      const m = Math.floor(s / 60);
      if (m < 60) return m + ' Ø¯Ù‚ÙŠÙ‚Ø©';
      const h = Math.floor(m / 60);
      if (h < 24) return h + ' Ø³Ø§Ø¹Ø©';
      const days = Math.floor(h / 24);
      return days + ' ÙŠÙˆÙ…';
    }

    // check hash for permalink navigation
    window.addEventListener('hashchange', () => {
      const h = location.hash.replace('#', '');
      if (h.startsWith('post-')) {
        const id = h.slice(5);
        const el = document.getElementById('post-' + id);
        if (el) {
          el.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
          });
          el.style.boxShadow = '0 0 0 3px rgba(6,182,212,0.12)';
          setTimeout(() => el.style.boxShadow = 'none', 2000);
        }
      }
    });

    // initial setup: create a demo user & seed posts if empty
    (function init() {
      const users = loadUsers();
      if (!users['demo']) {
        users['demo'] = {
          password: btoa('demo'),
          name: 'Demo Seller',
          avatar: null,
          bio: 'Ù…ØªØ¬Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ'
        };
        saveUsers(users);
      }
      
      if (!sessionStorage.getItem('currentUser')) {
        // keep currentUser null until login
      } else {
        currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
      }
      
      updateAuthUI();
      
      const posts = loadPosts();
      if (!posts || posts.length === 0) {
        // seed
        const seed = [];
        for (let i = 1; i <= 4; i++) {
          seed.push({
            id: 'seed_' + i,
            author: 'demo',
            authorName: 'Demo Seller',
            authorAvatar: null,
            title: 'Ù…Ù†ØªØ¬ ' + i,
            desc: 'ÙˆØµÙ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ù„Ù…Ù†ØªØ¬ ' + i,
            phone: '',
            link: '',
            price: i * 10 + ' USD',
            media: [],
            createdAt: Date.now() - i * 3600 * 1000,
            likes: i * 2,
            comments: [{
              user: 'user1',
              text: 'Ø¬ÙŠØ¯',
              at: Date.now() - 2000 * i
            }],
            shares: i
          });
        }
        savePosts(seed);
      }
      
      renderPosts();
      
      // if loaded with hash
      if (location.hash) {
        window.dispatchEvent(new HashChangeEvent('hashchange'));
      }
    })();

  </script>
</body>
</html>
