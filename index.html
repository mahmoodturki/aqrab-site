<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø£Ù‚Ø±Ø¨ Ø´ÙŠØ¡ Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø¢Ù† ğŸŒ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { margin:0; font-family: 'Cairo', sans-serif; text-align:center; }
    #map { height: 80vh; width: 100%; margin: 0 auto; }
    #buttons { padding:10px; background:#f8f9fa; overflow-x:auto; white-space:nowrap; }
    button { margin:4px; padding:8px 12px; border:none; border-radius:10px; background:#007bff; color:white; cursor:pointer; }
    button:hover { background:#0056b3; }
  </style>
</head>
<body dir="rtl">
  <h2>ğŸŒ Ø£Ù‚Ø±Ø¨ Ø´ÙŠØ¡ Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø¢Ù†</h2>

  <!-- ğŸ”¸ Ø¥Ø¹Ù„Ø§Ù† Adsterra Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <script type='text/javascript' src='//pl27783662.revenuecpmgate.com/8d/f4/a9/8df4a9bd2d8c6909d8f0cfc70ea9ec02.js'></script>

  <div id="buttons">
    <button onclick="findPlaces('restaurant')">Ù…Ø·Ø§Ø¹Ù… ğŸ½ï¸</button>
    <button onclick="findPlaces('pharmacy')">ØµÙŠØ¯Ù„ÙŠØ§Øª ğŸ’Š</button>
    <button onclick="findPlaces('hospital')">Ù…Ø³ØªØ´ÙÙŠØ§Øª ğŸ¥</button>
    <button onclick="findPlaces('school')">Ù…Ø¯Ø§Ø±Ø³ ğŸ“</button>
    <button onclick="findPlaces('university')">Ø¬Ø§Ù…Ø¹Ø§Øª ğŸ›ï¸</button>
    <button onclick="findPlaces('supermarket')">Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª ğŸ›’</button>
    <button onclick="findPlaces('bank')">Ø¨Ù†ÙˆÙƒ ğŸ¦</button>
    <button onclick="findPlaces('mosque')">Ù…Ø³Ø§Ø¬Ø¯ ğŸ•Œ</button>
    <button onclick="enableAddMode()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <div id="map"></div>

  <!-- ğŸ”¸ Ø¥Ø¹Ù„Ø§Ù† Adsterra Ø£Ø³ÙÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <script type='text/javascript' src='//pl27783662.revenuecpmgate.com/8d/f4/a9/8df4a9bd2d8c6909d8f0cfc70ea9ec02.js'></script>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    var map = L.map('map').setView([0, 0], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    let userMarker, tempMarker;
    let addMode = false;

    // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      map.setView([latitude, longitude], 14);
      userMarker = L.marker([latitude, longitude]).addTo(map).bindPopup("ğŸ“ Ø£Ù†Øª Ù‡Ù†Ø§").openPopup();
    });

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© (OpenStreetMap Nominatim)
    function findPlaces(type) {
      if (!map.getCenter()) return;
      const { lat, lng } = map.getCenter();
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${type}&addressdetails=1&limit=20&countrycodes=SA&extratags=1&viewbox=${lng-0.05},${lat+0.05},${lng+0.05},${lat-0.05}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          map.eachLayer(layer => {
            if (layer instanceof L.Marker && layer !== userMarker) map.removeLayer(layer);
          });
          data.forEach(place => {
            const marker = L.marker([place.lat, place.lon]).addTo(map);
            marker.bindPopup(`<b>${place.display_name}</b><br>${type}`);
          });
        });
    }

    // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    function enableAddMode() {
      addMode = true;
      alert("Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ“");
    }

    // Ø¯Ø¹Ù… Ø§Ù„Ù†Ù‚Ø± ÙˆØ§Ù„Ù„Ù…Ø³ Ù…Ø¹Ø§Ù‹ Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ù‚Ø¹
    function handleMapClick(e) {
      if (addMode) {
        if (tempMarker) map.removeLayer(tempMarker);
        tempMarker = L.marker(e.latlng).addTo(map).bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯");
        localStorage.setItem("tempLat", e.latlng.lat);
        localStorage.setItem("tempLon", e.latlng.lng);
        addMode = false;
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù‚ØªØ§Ù‹ âœ…");
      }
    }

    map.on("click", handleMapClick);
    map.on("touchend", handleMapClick);
  </script>
</body>
</html>
